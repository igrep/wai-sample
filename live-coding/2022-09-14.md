# Haskellã«ã‚ˆã‚‹ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° #53 è¤‡æ•°ã®ç¨®é¡ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹

å®Ÿéš›ã«é…ä¿¡ã—ãŸå‹•ç”»: <https://www.youtube.com/watch?v=CLN_2W9Rbig>

## ğŸ“ˆæœ¬æ—¥ã®ä¸»ãªé€²æ—

- ã€Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯é•ã†ã‘ã©handlerãŒè¿”ã™`resObj`ã®å‹ã¯åŒã˜ã«ã—ãŸã„ã€ã€ã¤ã¾ã‚Šã€
  ```haskell
  get @(Sum '[(PlainText, T.Text), (WithStatus Status503 PlainText, T.Text)]) ...
  ```
  ã®ã‚ˆã†ãª`resTyp`ã®handlerã‚’ä½œã‚ŠãŸã„å ´åˆã€ä¿®æ­£å‰ã ã¨`resObj`ãŒ`Sum '[T.Text, T.Text]`ã«ãªã£ã¦ã—ã¾ã„ã€è¤‡æ•°ã®`Sum`å‹ã«åŒã˜å‹ãŒè¤‡æ•°å«ã¾ã‚Œã¦ã—ã¾ã†ã®ã§ã€å¯¾å¿œã—ã¦ã„ã‚‹
    - <https://github.com/igrep/wai-sample/commit/c7b92ad525f997f4c1966c857607bf1c828cc096>

## â„¹ï¸è£œè¶³æƒ…å ±

### `OVERLAPPABLE`ãƒ—ãƒ©ã‚°ãƒ

wai-sampleã®ä»Šå›ã®ä¿®æ­£ï¼ˆèª¬æ˜ã®ãŸã‚ã«ç°¡ç•¥åŒ–ã—ã¦ã„ã¾ã™ï¼‰

```haskell
instance FromRawResponse (WithStatus status resTyp, resObj) where
  -- ...

instance FromRawResponse (WithStatus status resTyp, Response status resObj) where
  -- ...
```

ã®äºŒã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã€ã‚¿ãƒ—ãƒ«ã®äºŒã¤ç›®ã®è¦ç´ `resObj`ã¨`Response status resObj`ä»¥å¤–ã«é•ã„ãŒãªãã€ã—ã‹ã‚‚`resObj`ã¯å‹å¤‰æ•°ãªã®ã§`Response status resObj`ã«ã‚‚ãƒãƒƒãƒã™ã‚‹ã€‚ãªã®ã§ã€`instance FromRawResponse (WithStatus status resTyp, Response status resObj)`ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€Œæ›–æ˜§ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ã¨ã—ã¦å‹ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã€‚

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€ä»Šå›ã¯`OVERLAPPABLE`ãƒ—ãƒ©ã‚°ãƒã‚’æ¡ç”¨ã—ãŸ:

```haskell
instance {-# OVERLAPPABLE #-} FromRawResponse (WithStatus status resTyp, resObj) where
  -- ...

instance FromRawResponse (WithStatus status resTyp, Response status resObj) where
  -- ...
```

ã“ã®ã‚ˆã†ã«æ›¸ã„ãŸå ´åˆã€`{-# OVERLAPPABLE #-}`ã‚’ä»˜ã‘ãŸ`instance`ã¯ä»–ã®`instance`ã«ã‚ˆã£ã¦ã€Œoverlapã•ã‚Œã¦ã‚‚ã‚ˆã„ï¼ˆé‡è¤‡ã•ã‚Œã¦ã‚‚è‰¯ã„ï¼‰ã€ã¨æ‰±ã‚ã‚Œã€`{-# OVERLAPPABLE #-}`ãŒä»˜ã„ã¦ã„ãªã„`instance`ãŒå„ªå…ˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

å‚è€ƒ:

- [Overlapping Instancesã¨æˆ¦ã† - The curse of Î»](https://myuon.github.io/posts/overlapping-instances/)
- [6.8.8. Instance declarations and resolution â€” Glasgow Haskell Compiler 9.5.20220914 User's Guide](https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/instances.html)

## æ¬¡å›ï¼ˆä»¥é™ï¼‰

1. ã€Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯é•ã†ã‘ã©handlerãŒè¿”ã™`resObj`ã®å‹ã¯åŒã˜ã«ã—ãŸã„ã€å ´åˆã«ãŠã‘ã‚‹ã€ã‚‚ã£ã¨ã‚ˆã„ä»•æ§˜ãŒæ€ã„ã¤ã„ãŸã®ã§ä¿®æ­£ã—ã¾ã™
1. ãƒ†ã‚¹ãƒˆã‚’ç›´ã—ãŸã‚Šè¿½åŠ ã§æ›¸ã„ãŸã‚Šã—ã¾ã™
1. ã„ãã¤ã‹TODOã‚’æ®‹ã—ãŸã®ã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ç›´ã—ã¾ã™
